# my global config
global:
  scrape_interval: {{ prometheus_scrape_interval }}
  evaluation_interval: {{ prometheus_evaluation_interval }}

# Alertmanager configuration
alerting:
  alertmanagers:
    - static_configs:
        - targets:
            - "{{ inventory_hostname }}:9093"

# Load rule files
rule_files:
  - "rules.yml"

scrape_configs:

# Prometheus itself
  - job_name: "prometheus"
    static_configs:
      - targets:
          - "localhost:9090"

# Node Exporter for ALL monitored nodes
# This block dynamically scrapes all hosts in group ‘mon_clients’
  - job_name: "node_exporter"
    static_configs:
      - targets:
{% for host in groups['mon_clients'] %}
          - "{{ hostvars[host]['ansible_host'] }}:{{ node_exporter_port }}"
{% endfor %}

